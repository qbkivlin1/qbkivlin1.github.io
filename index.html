<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Marked in the browser</title>
</head>
<body>
  <div id="content"></div>
  <div>
    <form id="userinfo">
        <input type="text" id="input_text" name="input_text" placeholder="input your content" />
        <input type="submit" value="send" />
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>

    const form = document.querySelector("#userinfo");
    const chat_headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer sk-j56bfn0Ubn1uIsz9bIShyAGcwsGvYIyciT8DHxiImlCWhLlQ'
    }

    async function send_chat(input_text) {
        let req_json = 
        {
            "model": "deepseek-r1",
            "messages": [
                {
                    "role": "user",
                    "content": input_text
                }
            ]
        }
        try {
            const response = await fetch("https://api.lkeap.cloud.tencent.com/v1/chat/completions", {
            headers: chat_headers,
            method: "POST",
            // Set the FormData instance as the request body
            body: JSON.stringify(req_json),
            });
            return response.json();
        } catch (e) {
            console.error(e);
        }
    }

    // Take over form submission
    form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const form_data = new FormData(form);
        const input_text = form_data.get('input_text');
        if(input_text.length == 0) { return; };
        let rsp_json = await send_chat(input_text);
        console.log(rsp_json);
    });

    document.getElementById('content').innerHTML =
      marked.parse('# Marked in browser\n\nRendered by **marked**.');
  </script>
</body>
</html>